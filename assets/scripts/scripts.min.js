(function() {
    'use strict';

    angular.module('OneTimeNoteApp', ['ngRoute', 'ngSanitize'])
        .config(['$routeProvider', function ($routeProvider) {
            $routeProvider.
                when('/', { templateUrl: 'assets/angular/views/welcome.html', controller: 'OneTimeNoteWelcomeCtrl' }).
                when('/create', { templateUrl: 'assets/angular/views/create.html', controller: 'OneTimeNoteCreateCtrl' }).
                when('/create/success', { templateUrl: 'assets/angular/views/create-success.html', controller: 'OneTimeNoteCreateSuccessCtrl' }).
                when('/note/:url_id/:key', { templateUrl: 'assets/angular/views/note.html', controller: 'OneTimeNoteShowCtrl' }).
                when('/note-not-found', { templateUrl: 'assets/angular/views/note-not-found.html', controller: 'OneTimeNoteNotFoundCtrl' }).
                otherwise({ redirectTo: '/' });
        }
        ])
        .constant('ApiUrl', 'http://onetimenote.com')
})();
(function() {
    'use strict';

    angular.module('OneTimeNoteApp').controller('OneTimeNoteCreateCtrl', function($scope, $http, $location, OneTimeNoteFactory) {
        $http.defaults.headers.post["Content-Type"] = "application/x-www-form-urlencoded";

        $scope.note = null;
        3
        $scope.create = function() {
            OneTimeNoteFactory.create($scope.note)
        };

        $scope.$on('note.created', function(event, data) {
            $location.path('/create/success');
        });

        $scope.$on('note.failed', function(event, data) {

            if (!data) {
                data = { message: 'Something went wrong. Please try again later.' };
            }

            $scope.alerts = {
                type: 'warning',
                message: data.message
            }
        });
    });
})();

(function() {
    'use strict';

    angular.module('OneTimeNoteApp').controller('OneTimeNoteCreateSuccessCtrl', function($scope, $location, OneTimeNoteFactory) {
        $scope.note = OneTimeNoteFactory.note;

        // Check if note already exists in factory
        if (!$scope.note) {
            $location.path('/create');
        }
    });
})();

(function() {
    'use strict';

    angular.module('OneTimeNoteApp').controller('OneTimeNoteNotFoundCtrl', function($scope) {
        // Stuff here maybe?
    });
})();
(function() {
    'use strict';

    angular.module('OneTimeNoteApp').controller('OneTimeNoteShowCtrl', function($scope, $routeParams, $location, OneTimeNoteFactory, ApiUrl) {
        $scope.url = ApiUrl + '/note/' + $routeParams.url_id + '/' + $routeParams.key;

        OneTimeNoteFactory.view($scope.url);

        $scope.$on('note.found', function(event, data) {
            $scope.note = data;
        });

        $scope.$on('note.failed', function(event, data) {
            $location.path('/note-not-found')
        });
    });
})();
(function() {
    'use strict';

    angular.module('OneTimeNoteApp').controller('OneTimeNoteWelcomeCtrl', function($scope, $routeParams, $location, OneTimeNoteFactory) {
        // Stuff in here maybe?
    });
})();

(function() {
    'use strict';

    angular.module('OneTimeNoteApp').factory('OneTimeNoteFactory', function($rootScope, $http, ApiUrl) {
        var factory = {
            note: null,

            view: function(note) {
                $http.get(note).
                    success(function(data) {
                        factory.note = data;
                        $rootScope.$broadcast('note.found', data);
                    }).
                    error(function(data) {
                        factory.note = data;
                        $rootScope.$broadcast('note.failed', data);
                    });

            },
            create: function(newNote) {
                $http({ method: 'POST', url: ApiUrl + '/note', data: newNote }).
                    success(function(data) {
                        factory.note = data;
                        $rootScope.$broadcast('note.created', data);
                    }).
                    error(function(data) {
                        factory.note = data;
                        $rootScope.$broadcast('note.failed', data);
                    });
            }
        };

        return factory;
    });
})();
(function($) {
    $(document).foundation();
})(jQuery);